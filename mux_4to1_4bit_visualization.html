<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4-Bit 4-to-1 Multiplexer Visualization</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            height: 100vh;
            margin: 0;
            padding: 20px;
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            flex-shrink: 0;
        }

        h1 {
            margin: 0;
            color: #4fc3f7;
            font-size: 1.8em;
            letter-spacing: 1px;
        }

        p.subtitle {
            margin: 5px 0 0;
            color: #90a4ae;
            font-size: 1em;
        }

        .main-container {
            display: flex;
            flex: 1;
            gap: 20px;
            min-height: 0;
        }

        /* --- LEFT PANEL: DIAGRAM --- */
        .diagram-panel {
            flex: 6;
            background: #0d1b2a;
            border-radius: 12px;
            border: 2px solid #546e7a;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .panel-header {
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid #546e7a;
            color: #b0bec5;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        svg {
            flex: 1;
            width: 100%;
            height: 100%;
            cursor: default;
        }

        /* SVG Styles */
        .mux-body {
            fill: #1a237e;
            stroke: #5c6bc0;
            stroke-width: 3;
            filter: drop-shadow(0 0 5px rgba(26, 35, 126, 0.5));
        }

        .wire {
            fill: none;
            stroke: #37474f;
            stroke-width: 6;
            /* Thicker for bus */
            stroke-linecap: round;
            transition: stroke 0.3s ease;
        }

        .wire-sel {
            stroke-width: 4;
        }

        .wire.active-bus {
            stroke: #ffd54f;
            /* Yellowish for data bus */
            filter: drop-shadow(0 0 3px #ffd54f);
        }

        .wire.inactive-bus {
            stroke: #37474f;
            opacity: 0.5;
        }

        .wire.sel-active {
            stroke: #00e676;
            filter: drop-shadow(0 0 3px #00e676);
        }

        .wire.sel-inactive {
            stroke: #0277bd;
        }

        .wire-path {
            stroke-dasharray: 10 6;
            animation: flow 1s linear infinite;
            opacity: 0.8;
            display: none;
            stroke-width: 4;
        }

        @keyframes flow {
            to {
                stroke-dashoffset: -16;
            }
        }

        .toggle-switch {
            cursor: pointer;
            transition: transform 0.1s;
        }

        .toggle-switch:hover {
            transform: scale(1.1);
        }

        .switch-rect {
            fill: #263238;
            stroke: #78909c;
            stroke-width: 2;
        }

        /* Select Button Colors */
        .switch-rect.sel-0 {
            fill: #263238;
            stroke: #90a4ae;
        }

        .switch-rect.sel-1 {
            fill: #004d40;
            stroke: #00e676;
        }

        .switch-rect.sel-2 {
            fill: #01579b;
            stroke: #03a9f4;
        }

        .switch-rect.sel-3 {
            fill: #311b92;
            stroke: #b388ff;
        }

        .label-text {
            fill: #eceff1;
            font-family: monospace;
            font-size: 14px;
            pointer-events: none;
            text-anchor: middle;
            dominant-baseline: middle;
        }

        .bus-slash {
            stroke: #b0bec5;
            stroke-width: 2;
        }

        .bus-label {
            fill: #b0bec5;
            font-size: 10px;
            font-family: monospace;
        }

        .val-text {
            fill: #fff;
            font-weight: bold;
            font-family: monospace;
            pointer-events: none;
            text-anchor: middle;
            dominant-baseline: middle;
            font-size: 16px;
        }

        .sel-text {
            fill: #b0bec5;
            font-family: monospace;
            font-size: 12px;
            text-anchor: middle;
        }

        /* --- RIGHT PANEL: CODE --- */
        .code-panel {
            flex: 4;
            background: #263238;
            border-radius: 12px;
            border: 2px solid #546e7a;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .code-content {
            flex: 1;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            color: #eceff1;
            font-size: 16px;
            line-height: 1.6;
            overflow-y: auto;
            white-space: pre;
        }

        /* Syntax Highlighting */
        .kwd {
            color: #ba68c8;
            font-weight: bold;
        }

        .mod {
            color: #4fc3f7;
        }

        .type {
            color: #ffd54f;
        }

        .port {
            color: #ff8a65;
        }

        .op {
            color: #fff;
        }

        .comment {
            color: #546e7a;
            font-style: italic;
        }

        .highlight-line {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            transition: background 0.2s;
        }

        .active-logic {
            background: rgba(255, 213, 79, 0.15);
            /* Yellow tint */
            border-left: 3px solid #ffd54f;
        }

        .controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px;
            border-radius: 8px;
            color: #cfd8dc;
            font-size: 0.9em;
        }
    </style>
</head>

<body>

    <div class="header">
        <h1>4-Bit 4-to-1 Multiplexer</h1>
        <p class="subtitle">Interactive Logic Visualization</p>
    </div>

    <div class="main-container">
        <!-- DIAGRAM PANEL -->
        <div class="diagram-panel">
            <div class="panel-header">
                <span>RTL Schematic</span>
                <span style="font-size: 0.8em; color: #78909c;">Click inputs to cycle Hex &bull; Click Sel to cycle
                    0-3</span>
            </div>

            <svg id="mainSvg" viewBox="0 0 600 500" preserveAspectRatio="xMidYMid meet">
                <defs>
                    <g id="slash">
                        <line x1="-3" y1="5" x2="3" y2="-5" class="bus-slash" />
                        <text x="5" y="-3" class="bus-label">4</text>
                    </g>
                    <g id="slash2">
                        <line x1="-3" y1="5" x2="3" y2="-5" class="bus-slash" />
                        <text x="5" y="-3" class="bus-label">2</text>
                    </g>
                </defs>

                <!-- MUX Symbol (Taller) -->
                <!-- Inputs spaced 60px apart: 100, 160, 220, 280 -->
                <polygon points="250,60 350,90 350,310 250,340" class="mux-body" />
                <text x="300" y="200" fill="white" text-anchor="middle" dominant-baseline="middle" font-weight="bold"
                    font-size="20">MUX</text>
                <text x="320" y="290" fill="#9fa8da" text-anchor="middle" font-size="12">4:1</text>

                <!-- Wires -->

                <!-- Input 0 -->
                <line id="wire_i0" x1="100" y1="100" x2="250" y2="100" class="wire" />
                <use href="#slash" x="175" y="100" />
                <text x="240" y="90" fill="#b0bec5" font-size="12" text-anchor="end">i0[3:0]</text>

                <!-- Input 1 -->
                <line id="wire_i1" x1="100" y1="160" x2="250" y2="160" class="wire" />
                <use href="#slash" x="175" y="160" />
                <text x="240" y="150" fill="#b0bec5" font-size="12" text-anchor="end">i1[3:0]</text>

                <!-- Input 2 -->
                <line id="wire_i2" x1="100" y1="220" x2="250" y2="220" class="wire" />
                <use href="#slash" x="175" y="220" />
                <text x="240" y="210" fill="#b0bec5" font-size="12" text-anchor="end">i2[3:0]</text>

                <!-- Input 3 -->
                <line id="wire_i3" x1="100" y1="280" x2="250" y2="280" class="wire" />
                <use href="#slash" x="175" y="280" />
                <text x="240" y="270" fill="#b0bec5" font-size="12" text-anchor="end">i3[3:0]</text>

                <!-- Select (Bottom) -->
                <line id="wire_sel" x1="300" y1="415" x2="300" y2="325" class="wire wire-sel" />
                <use href="#slash2" x="300" y="370" />
                <text x="310" y="350" fill="#b0bec5" font-size="12" text-anchor="start">sel[1:0]</text>

                <!-- Output -->
                <line id="wire_y" x1="350" y1="200" x2="500" y2="200" class="wire" />
                <use href="#slash" x="425" y="200" />
                <text x="360" y="190" fill="#b0bec5" font-size="12" text-anchor="start">y[3:0]</text>

                <!-- Internal Paths (Animated) -->
                <path id="path_i0" d="M 250 100 C 280 100, 320 200, 350 200" class="wire active-bus wire-path"
                    stroke-width="4" fill="none" />
                <path id="path_i1" d="M 250 160 C 280 160, 320 200, 350 200" class="wire active-bus wire-path"
                    stroke-width="4" fill="none" />
                <path id="path_i2" d="M 250 220 C 280 220, 320 200, 350 200" class="wire active-bus wire-path"
                    stroke-width="4" fill="none" />
                <path id="path_i3" d="M 250 280 C 280 280, 320 200, 350 200" class="wire active-bus wire-path"
                    stroke-width="4" fill="none" />

                <!-- Inputs (Hex Boxes) -->
                <g transform="translate(80, 100)">
                    <g class="toggle-switch" onclick="cycleValue('i0')">
                        <rect x="-25" y="-20" width="50" height="40" rx="4" class="switch-rect" stroke="#ffd54f"
                            id="rect_i0" />
                        <text x="0" y="2" class="val-text" id="txt_i0" fill="#ffd54f">0</text>
                        <text x="0" y="-28" class="label-text">i0</text>
                    </g>
                </g>
                <g transform="translate(80, 160)">
                    <g class="toggle-switch" onclick="cycleValue('i1')">
                        <rect x="-25" y="-20" width="50" height="40" rx="4" class="switch-rect" stroke="#ffd54f"
                            id="rect_i1" />
                        <text x="0" y="2" class="val-text" id="txt_i1" fill="#ffd54f">1</text>
                        <text x="0" y="-28" class="label-text">i1</text>
                    </g>
                </g>
                <g transform="translate(80, 220)">
                    <g class="toggle-switch" onclick="cycleValue('i2')">
                        <rect x="-25" y="-20" width="50" height="40" rx="4" class="switch-rect" stroke="#ffd54f"
                            id="rect_i2" />
                        <text x="0" y="2" class="val-text" id="txt_i2" fill="#ffd54f">2</text>
                        <text x="0" y="-28" class="label-text">i2</text>
                    </g>
                </g>
                <g transform="translate(80, 280)">
                    <g class="toggle-switch" onclick="cycleValue('i3')">
                        <rect x="-25" y="-20" width="50" height="40" rx="4" class="switch-rect" stroke="#ffd54f"
                            id="rect_i3" />
                        <text x="0" y="2" class="val-text" id="txt_i3" fill="#ffd54f">3</text>
                        <text x="0" y="-28" class="label-text">i3</text>
                    </g>
                </g>

                <!-- Select Buttons -->
                <g transform="translate(300, 430)">
                    <text x="0" y="-25" class="label-text">sel[1:0]</text>

                    <!-- Button 0 -->
                    <g transform="translate(-60, 0)">
                        <g class="toggle-switch" onclick="setSel(0)">
                            <rect x="-15" y="-15" width="30" height="30" rx="4" class="switch-rect" id="btn_sel_0" />
                            <text x="0" y="5" class="val-text" font-size="14">0</text>
                        </g>
                    </g>
                    <!-- Button 1 -->
                    <g transform="translate(-20, 0)">
                        <g class="toggle-switch" onclick="setSel(1)">
                            <rect x="-15" y="-15" width="30" height="30" rx="4" class="switch-rect" id="btn_sel_1" />
                            <text x="0" y="5" class="val-text" font-size="14">1</text>
                        </g>
                    </g>
                    <!-- Button 2 -->
                    <g transform="translate(20, 0)">
                        <g class="toggle-switch" onclick="setSel(2)">
                            <rect x="-15" y="-15" width="30" height="30" rx="4" class="switch-rect" id="btn_sel_2" />
                            <text x="0" y="5" class="val-text" font-size="14">2</text>
                        </g>
                    </g>
                    <!-- Button 3 -->
                    <g transform="translate(60, 0)">
                        <g class="toggle-switch" onclick="setSel(3)">
                            <rect x="-15" y="-15" width="30" height="30" rx="4" class="switch-rect" id="btn_sel_3" />
                            <text x="0" y="5" class="val-text" font-size="14">3</text>
                        </g>
                    </g>
                </g>

                <!-- Output -->
                <g transform="translate(530, 200)">
                    <rect x="-25" y="-20" width="50" height="40" rx="4" class="switch-rect" stroke="#ffd54f"
                        id="rect_y" />
                    <text x="0" y="2" class="val-text" id="txt_y">0</text>
                    <text x="0" y="-28" class="label-text">y</text>
                </g>

            </svg>

            <div class="controls">
                Status: <span id="statusText" style="color:#ffd54f">Waiting...</span>
            </div>
        </div>

        <!-- CODE PANEL -->
        <div class="code-panel">
            <div class="panel-header">Verilog Source</div>
            <div class="code-content"><span class="kwd">module</span> <span class="mod">mux_4to1_4bit</span> (
                <span class="kwd">input</span> <span class="type">wire</span> [3:0] i0, i1, i2, i3,
                <span class="kwd">input</span> <span class="type">wire</span> [1:0] sel,
                <span class="kwd">output</span> <span class="type">reg</span> [3:0] y
                );

                <span class="kwd">always</span> @(*) <span class="kwd">begin</span>
                <span class="kwd">case</span> (sel)
                <div id="code_0" class="highlight-line"> <span class="op">2'd0</span>: y = i0;</div>
                <div id="code_1" class="highlight-line"> <span class="op">2'd1</span>: y = i1;</div>
                <div id="code_2" class="highlight-line"> <span class="op">2'd2</span>: y = i2;</div>
                <div id="code_3" class="highlight-line"> <span class="op">2'd3</span>: y = i3;</div>
                <span class="kwd">endcase</span>
                <span class="kwd">end</span>

                <span class="kwd">endmodule</span>
            </div>

            <div style="padding: 20px; border-top: 1px solid #546e7a;">
                <h4 style="margin: 0 0 10px 0; color: #b0bec5;">Logic Analysis</h4>
                <div id="logicExplanation" style="font-size: 0.9em; color: #90a4ae;">
                    Current state explanation...
                </div>
            </div>
        </div>
    </div>

    <script>
        const state = {
            i0: 0xA, i1: 0xB, i2: 0xC, i3: 0xD,
            sel: 0,
            y: 0
        };

        function cycleValue(key) {
            state[key] = (state[key] + 1) % 16;
            update();
        }

        function setSel(val) {
            state.sel = val;
            update();
        }

        function update() {
            // Logic
            switch (state.sel) {
                case 0: state.y = state.i0; break;
                case 1: state.y = state.i1; break;
                case 2: state.y = state.i2; break;
                case 3: state.y = state.i3; break;
            }

            // UI Texts
            ['i0', 'i1', 'i2', 'i3'].forEach(k => {
                document.getElementById(`txt_${k}`).textContent = state[k].toString(16).toUpperCase();
            });

            document.getElementById('txt_y').textContent = state.y.toString(16).toUpperCase();

            // Wires & Paths
            // Reset all
            document.querySelectorAll('.wire-path').forEach(e => e.style.display = 'none');
            document.querySelectorAll('.wire').forEach(e => {
                if (!e.classList.contains('wire-sel') && e.id !== 'wire_y' && !e.classList.contains('wire-path')) {
                    e.setAttribute('class', 'wire inactive-bus');
                }
            });
            document.querySelectorAll('.highlight-line').forEach(e => e.classList.remove('active-logic'));

            // Activate Selected
            document.getElementById(`path_i${state.sel}`).style.display = 'block';
            document.getElementById(`wire_i${state.sel}`).setAttribute('class', 'wire active-bus');
            document.getElementById(`path_i${state.sel}`).setAttribute('stroke', '#ffd54f');

            // Output always active
            document.getElementById('wire_y').setAttribute('class', 'wire active-bus');
            // Select line always active
            document.getElementById('wire_sel').setAttribute('class', 'wire wire-sel sel-active');

            // ------------------------------------------
            // Highlight Active Data Flow (Rect Fills)
            // ------------------------------------------
            // 1. Reset all inputs to dark base
            ['i0', 'i1', 'i2', 'i3'].forEach(k => {
                const r = document.getElementById(`rect_${k}`);
                r.setAttribute('fill', '#263238');
                r.setAttribute('stroke', '#ffd54f'); // Reset to default stroke
            });
            // Reset output too
            document.getElementById('rect_y').setAttribute('fill', '#263238');
            document.getElementById('rect_y').setAttribute('stroke', '#ffd54f');


            // 2. Highlight Selected Input
            const activeInput = document.getElementById(`rect_i${state.sel}`);
            activeInput.setAttribute('fill', 'rgba(0, 230, 118, 0.25)'); // Brighter Green Tint
            activeInput.setAttribute('stroke', '#00e676'); // Bright Green Border

            // 3. Highlight Output
            const activeOutput = document.getElementById('rect_y');
            activeOutput.setAttribute('fill', 'rgba(0, 230, 118, 0.25)');
            activeOutput.setAttribute('stroke', '#00e676');
            // ------------------------------------------

            // Select Buttons Visuals
            for (let i = 0; i < 4; i++) {
                const btn = document.getElementById(`btn_sel_${i}`);
                if (i === state.sel) {
                    btn.classList.remove('sel-0', 'sel-1', 'sel-2', 'sel-3'); // Clean
                    btn.setAttribute('stroke', '#00e676');
                    btn.setAttribute('fill', '#004d40');
                } else {
                    btn.setAttribute('stroke', '#546e7a');
                    btn.setAttribute('fill', '#263238');
                }
            }

            // Code Highlight
            document.getElementById(`code_${state.sel}`).classList.add('active-logic');

            // Status & Text
            const valHex = state[`i${state.sel}`].toString(16).toUpperCase();
            document.getElementById('statusText').innerHTML =
                `Select is ${state.sel}. <b>i${state.sel} (0x${valHex})</b> passed to <b>y</b>.`;

            document.getElementById('logicExplanation').innerHTML = `
                <code>sel == ${state.sel}</code> (Binary <code>${state.sel.toString(2).padStart(2, '0')}</code>)<br>
                Selected: <code>case(2'd${state.sel}): y = i${state.sel};</code><br>
                Output: <code>0x${state.y.toString(16).toUpperCase()}</code>
            `;
        }

        update();
    </script>
</body>

</html>